---
title: "can_census_2021"
author: "Zehui Yin"
format: html
---

```{r}
library(sf)
library(cancensus)
library(mapview)
library(tidyverse)
readRenviron(".Renviron")
```

```{r}
options(cancensus.api_key = Sys.getenv("API_key"))
options(cancensus.cache_path = "./census_data")

# Returns data and geography as an sf-class data frame
census_data <- get_census(
  # 2021 census
  dataset = "CA21", 
  # CSD Hamilton
  regions = list(CSD="3525005"), 
  # population count
  vectors = c("v_CA21_1"), 
  labels = "detailed", 
  geo_format = "sf",
  # at Census Tract level
  level = "CT")

mapview(census_data)
```

```{r}
census_data |>
  mutate(density = `v_CA21_1: Population, 2021`/`Area (sq km)`) |>
  ggplot() +
  geom_sf(aes(fill = density))

ggsave("./images/hamilton_CT.png", dpi = 300,
       width = 7.29, height = 4.5)
```

```{r}
st_write(census_data, "./data-raw/hamilton_CT.geojson")
```
